<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Bike Detail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-8">
        <a href="/" class="text-blue-500 hover:underline">&larr; Back to all bikes</a>
        <div id="bike-detail" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
            <div id="bike-image"></div>
            <div id="bike-info"></div>
        </div>
    </div>

    <script>
        const bikeDetail = document.getElementById('bike-detail');
        const bikeImage = document.getElementById('bike-image');
        const bikeInfo = document.getElementById('bike-info');

        async function fetchBikeDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const bikeId = urlParams.get('id');

            if (bikeId) {
                try {
                    const response = await fetch(`/api/bikes/${bikeId}`);
                    const bike = await response.json();

                    if (response.ok) {
                        bikeImage.innerHTML = `<img src="${bike.imageUrl}" alt="${bike.make} ${bike.model}" class="w-full rounded-lg">`;
                        bikeInfo.innerHTML = `
                            <h1 class="text-4xl font-bold mb-4">${bike.make} ${bike.model} (${bike.year})</h1>
                            <div class="flex items-center mb-4">
                                ${[...Array(5)].map((_, i) => `
                                    <span class="material-symbols-outlined ${i < bike.averageRating ? 'text-yellow-500' : 'text-gray-300'}">star</span>
                                `).join('')}
                                <span class="ml-2 text-gray-600">${bike.averageRating ? bike.averageRating.toFixed(1) : 'No ratings'}</span>
                            </div>
                            <p class="text-gray-700 text-lg mb-4">${bike.description}</p>
                            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add to Comparison</button>
                        </div>

                        <div class="mt-8">
                            <h2 class="text-2xl font-bold mb-4">Comments</h2>
                            <div id="comments-list"></div>
                        </div>
                        `;

                        const commentsList = document.getElementById('comments-list');
                        if (bike.comments && bike.comments.length > 0) {
                            commentsList.innerHTML = bike.comments.map(comment => `
                                <div class="bg-gray-50 p-4 rounded-lg mb-2">
                                    <p class="text-gray-800">${comment}</p>
                                </div>
                            `).join('');
                        } else {
                            commentsList.innerHTML = '<p class="text-gray-600">No comments yet.</p>';
                        }
                    }

                    } else {
                        bikeDetail.innerHTML = `<p class="text-red-500 text-center">${bike.error}</p>`;
                    }
                } catch (error) {
                    console.error('Error fetching bike details:', error);
                    bikeDetail.innerHTML = '<p class="text-red-500 text-center">Error loading bike details. Please try again later.</p>';
                }
            } else {
                bikeDetail.innerHTML = '<p class="text-red-500 text-center">No bike ID provided.</p>';
            }
        }

        fetchBikeDetails();
    </script>
</body>
</html>